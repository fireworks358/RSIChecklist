<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#005EB8">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Airway Portal">
  <link rel="manifest" href="./mobile-manifest.json">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <title>Emergency Airway Portal</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #F0F4F5;
      color: #212B32;
      min-height: 100vh;
      min-height: 100dvh;
    }

    /* ── Header ── */
    header {
      background: #005EB8;
      color: white;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px 10px;
    }

    .header-title {
      font-size: 17px;
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.01em;
    }

    .header-subtitle {
      font-size: 11px;
      opacity: 0.75;
      margin-top: 2px;
      letter-spacing: 0.01em;
    }

    .back-btn {
      flex-shrink: 0;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.35);
      border-radius: 8px;
      padding: 9px 14px;
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: background 0.15s;
    }

    .back-btn:active {
      background: rgba(255, 255, 255, 0.28);
    }

    /* ── Tabs ── */
    .tabs {
      display: flex;
      background: #004b8f;
      padding: 0 16px;
    }

    .tab-btn {
      flex: 1;
      padding: 11px 8px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      color: rgba(255, 255, 255, 0.65);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: color 0.15s, border-color 0.15s;
      letter-spacing: 0.01em;
    }

    .tab-btn.active {
      color: white;
      border-bottom-color: #FFB81C;
    }

    /* ── Main Content ── */
    main {
      padding: 16px;
      max-width: 560px;
      margin: 0 auto;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .section-hint {
      font-size: 13px;
      color: #4C6272;
      background: white;
      border-radius: 8px;
      padding: 10px 14px;
      margin-bottom: 14px;
      border-left: 3px solid #41B6E6;
    }

    /* ── Subcategory header ── */
    .subcategory-header {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #4C6272;
      margin: 22px 0 8px 2px;
    }

    /* ── Guideline link ── */
    .guideline-link {
      display: flex;
      align-items: center;
      gap: 12px;
      background: white;
      border-radius: 10px;
      padding: 14px 14px 14px 16px;
      margin-bottom: 8px;
      text-decoration: none;
      color: #212B32;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      border-left: 4px solid #005EB8;
      transition: transform 0.1s, background 0.1s;
      -webkit-user-select: none;
      user-select: none;
    }

    .guideline-link:active {
      background: #edf2f7;
      transform: scale(0.985);
    }

    .guideline-link.arrest {
      border-left-color: #AE2573;
    }

    .guideline-text {
      flex: 1;
      min-width: 0;
    }

    .guideline-name {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.3;
    }

    .guideline-desc {
      font-size: 12px;
      color: #4C6272;
      margin-top: 2px;
      line-height: 1.4;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pdf-chevron {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      color: #768692;
    }

    .guideline-link.arrest .pdf-chevron {
      color: #AE2573;
      opacity: 0.7;
    }
  </style>
</head>
<body>

  <header>
    <div class="header-top">
      <div>
        <div class="header-title">Emergency Airway Portal</div>
        <div class="header-subtitle">Quick Reference Guidelines</div>
      </div>
      <a href="https://odpcoordinator.netlify.app/odp.html" class="back-btn">
        &#8592; Back to App
      </a>
    </div>
    <div class="tabs" role="tablist">
      <button class="tab-btn active" onclick="switchTab('adult')" role="tab" aria-selected="true" aria-controls="adult-section">
        Adult
      </button>
      <button class="tab-btn" onclick="switchTab('paediatric')" role="tab" aria-selected="false" aria-controls="paediatric-section">
        Paediatric
      </button>
    </div>
  </header>

  <main>
    <div id="adult-section" class="section active" role="tabpanel"></div>
    <div id="paediatric-section" class="section" role="tabpanel"></div>
  </main>

  <script>
    const ADULT = [
      { title: 'RSI Checklist',                  path: './guidelines/adult/rsi-checklist.pdf',                                                          desc: 'Rapid Sequence Intubation checklist' },
      { title: 'Difficult Airway Algorithm',      path: './guidelines/adult/difficult-airway-algorithm.pdf',                                             desc: 'Management algorithm for difficult airways' },
      { title: 'CICO Algorithm',                  path: './guidelines/adult/cico-algorithm.pdf',                                                         desc: "Can't Intubate, Can't Oxygenate protocol" },
      { title: 'Failed Intubation Drill',         path: './guidelines/adult/failed-intubation-drill.pdf',                                                desc: 'Protocol for failed intubation scenarios' },
      { title: 'Bradyarrhythmia 2025',            path: './guidelines/adult/Adult bradyarrhythmia 2025.pdf',                                             desc: 'Management of adult bradyarrhythmias' },
      { title: 'Tachyarrhythmia 2025',            path: './guidelines/adult/Adult tachyarrhythmia algorithm 2025.pdf',                                   desc: 'Management of adult tachyarrhythmias' },
      { title: 'Anaphylaxis 2021',                path: './guidelines/adult/Anaphylaxis algorithm 2021.pdf',                                             desc: 'Anaphylaxis management algorithm' },
      { title: 'Massive Haemorrhage',             path: './guidelines/adult/Massive Haemorrhage Guideline.pdf',                                          desc: 'Management protocol for massive haemorrhage' },
      { title: 'Critical Care Infusions',         path: './guidelines/adult/Critical Care Infusions guideline (1).pdf',                                  desc: 'Guide to critical care drug infusions' },
      { title: 'Critical Care Transfer',          path: './guidelines/adult/Critical Care Transfer Team.pdf',                                            desc: 'Critical care transfer team guidelines' },
      { title: 'High Flow Nasal Oxygen',          path: './guidelines/adult/High Flow Nasal Oxygen (HFNO)  in Theatres.pdf',                             desc: 'HFNO use in operating theatres' },
      { title: 'GA Checklist',                    path: './guidelines/adult/GA Checklist.pdf',                                                           desc: 'General anaesthesia checklist' },
      { title: 'Emergency Equipment',             path: './guidelines/adult/Emergency Equipment locations.pdf',                                          desc: 'Emergency equipment locations reference' },
      // Arrest subcategory
      { title: 'ALS Algorithm 2025',              path: './guidelines/adult/Adult ALS algorithm 2025.pdf',                                               desc: 'Adult advanced life support algorithm (2025)',          subcategory: 'Arrest' },
      { title: 'Choking Algorithm 2025',          path: './guidelines/adult/Adult choking algorithm 2025 .pdf',                                          desc: 'Adult choking management algorithm (2025)',             subcategory: 'Arrest' },
      { title: 'In Hospital Algorithm 2025',      path: './guidelines/adult/Adult in hospital algorithm 2025.pdf',                                       desc: 'Adult in-hospital resuscitation algorithm (2025)',      subcategory: 'Arrest' },
      { title: 'Reversible Causes',               path: './guidelines/adult/Reversable causes of cardiac arrest vs5 Jan 2019 12 0370.pdf',               desc: 'Reversible causes of cardiac arrest (4Hs and 4Ts)',    subcategory: 'Arrest' },
      { title: 'Special Circumstances',           path: './guidelines/adult/Special circumstances Guidelines (2).pdf',                                   desc: 'Guidelines for special circumstances',                 subcategory: 'Arrest' },
    ];

    const PAEDIATRIC = [
      { title: 'RSI Checklist',                   path: './guidelines/paediatric/rsi-checklist.pdf',                                                     desc: 'RSI checklist for paediatric patients' },
      { title: 'Difficult Airway Algorithm',       path: './guidelines/paediatric/difficult-airway-algorithm.pdf',                                        desc: 'Algorithm for difficult paediatric airways' },
      { title: 'CICO Algorithm',                   path: './guidelines/paediatric/cico-algorithm.pdf',                                                    desc: "Can't Intubate, Can't Oxygenate protocol" },
      { title: 'Failed Intubation Drill',          path: './guidelines/paediatric/failed-intubation-drill.pdf',                                           desc: 'Protocol for failed intubation scenarios' },
      { title: 'Intubation Checklist',             path: './guidelines/paediatric/intubation-checklist-2024.pdf',                                         desc: 'SORT intubation checklist (2024)' },
      { title: 'Anaesthesia for Emergencies',      path: './guidelines/paediatric/anaesthesia-for-emergencies.pdf',                                       desc: 'Emergency anaesthesia procedures' },
      { title: 'Anaphylaxis',                      path: './guidelines/paediatric/anaphylaxis.pdf',                                                       desc: 'Emergency management of anaphylaxis' },
      { title: 'Arrhythmias',                      path: './guidelines/paediatric/arrhythmias.pdf',                                                       desc: 'Recognition and management of arrhythmias' },
      { title: 'Sepsis (QRG)',                     path: './guidelines/paediatric/sepsis-qrg.pdf',                                                        desc: 'Quick reference guide for sepsis management' },
      { title: 'Seizures',                         path: './guidelines/paediatric/seizures.pdf',                                                          desc: 'Management of seizures and status epilepticus' },
      { title: 'Bronchiolitis',                    path: './guidelines/paediatric/bronchiolitis.pdf',                                                     desc: 'Management guideline for bronchiolitis' },
      { title: 'Upper Airway Obstruction',         path: './guidelines/paediatric/upper-airway-obstruction.pdf',                                          desc: 'Managing upper airway obstruction' },
      { title: 'Ventilation Initiation',           path: './guidelines/paediatric/ventilation-initiation.pdf',                                            desc: 'Initiating mechanical ventilation' },
      { title: 'Ventilated Child Checklist',       path: './guidelines/paediatric/caring-for-ventilated-child-checklist.pdf',                             desc: 'Checklist for caring for ventilated children' },
      { title: 'Extubation Checklist',             path: './guidelines/paediatric/extubation-checklist.pdf',                                              desc: 'Safety checklist for paediatric extubation' },
      { title: 'Trauma Reference',                 path: './guidelines/paediatric/trauma-reference-document.pdf',                                         desc: 'Comprehensive trauma management reference' },
      { title: 'Haemorrhage (QRG)',                path: './guidelines/paediatric/haemorrhage-qrg.pdf',                                                   desc: 'Quick reference guide for haemorrhage' },
      { title: 'Drowning',                         path: './guidelines/paediatric/drowning.pdf',                                                          desc: 'Management protocol for drowning' },
      { title: 'Hypothermia',                      path: './guidelines/paediatric/hypothermia.pdf',                                                       desc: 'Management of paediatric hypothermia' },
      { title: 'Neonatal Collapse',                path: './guidelines/paediatric/neonatal-collapse.pdf',                                                 desc: 'Emergency management of neonatal collapse' },
      { title: 'IO Insertion Guide',               path: './guidelines/paediatric/io-insertion-guide.pdf',                                                desc: 'Guide for intraosseous access insertion' },
      { title: 'Drug Infusion Guide',              path: './guidelines/paediatric/drug-infusion-guide.pdf',                                               desc: 'Drug infusions during SORT transfers' },
      { title: 'Infusion Calculations',            path: './guidelines/paediatric/infusion-calculations.pdf',                                             desc: 'Quick reference for calculating infusion rates' },
      { title: 'Time Critical Transfer Checklist', path: './guidelines/paediatric/time-critical-transfer-checklist.pdf',                                  desc: 'Checklist for time-critical transfers' },
      { title: 'PICU Handover Checklist',          path: './guidelines/paediatric/picu-handover-checklist.pdf',                                           desc: 'Structured handover checklist for PICU' },
      { title: 'PDCH',                             path: './guidelines/paediatric/PDCH.pdf',                                                              desc: 'PDCH guideline' },
      // Arrest subcategory
      { title: 'Cardiac Arrest (ALS)',             path: './guidelines/paediatric/cardiac-arrest-als.pdf',                                                desc: 'ALS protocol for paediatric cardiac arrest',           subcategory: 'Arrest' },
      { title: 'ROSC Management',                  path: './guidelines/paediatric/rosc-management.pdf',                                                   desc: 'Return of spontaneous circulation management',         subcategory: 'Arrest' },
      { title: 'PALS Algorithm 2025',              path: './guidelines/paediatric/Paediatric advanced life support algorithm 2025.pdf',                   desc: 'Paediatric advanced life support (2025)',               subcategory: 'Arrest' },
      { title: 'Newborn Life Support 2025',        path: './guidelines/paediatric/Newborn life support algorithm 2025.pdf',                               desc: 'Newborn life support algorithm (2025)',                 subcategory: 'Arrest' },
      { title: 'Advanced Newborn Resus',           path: './guidelines/paediatric/Advanced resuscitation of the newborn infant algorithm 2025_0.pdf',    desc: 'Advanced newborn resuscitation (2025)',                subcategory: 'Arrest' },
    ];

    const CHEVRON = `<svg class="pdf-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>`;

    function renderSection(guidelines, containerId) {
      const container = document.getElementById(containerId);
      const noSub = guidelines.filter(g => !g.subcategory);
      const bySub = guidelines.reduce((acc, g) => {
        if (g.subcategory) {
          (acc[g.subcategory] = acc[g.subcategory] || []).push(g);
        }
        return acc;
      }, {});

      let html = `<p class="section-hint">Tap a guideline to open the PDF with your device's reader.</p>`;

      noSub.forEach(g => {
        html += guidelineHTML(g);
      });

      Object.entries(bySub).forEach(([sub, items]) => {
        html += `<div class="subcategory-header">${sub}</div>`;
        items.forEach(g => { html += guidelineHTML(g, true); });
      });

      container.innerHTML = html;
    }

    function guidelineHTML(g, isArrest = false) {
      const cls = isArrest ? ' arrest' : '';
      // Encode the path for use as an href
      const href = g.path.replace(/ /g, '%20');
      return `<a href="${href}" target="_blank" rel="noopener noreferrer" class="guideline-link${cls}">
  <div class="guideline-text">
    <div class="guideline-name">${g.title}</div>
    <div class="guideline-desc">${g.desc}</div>
  </div>
  ${CHEVRON}
</a>`;
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        const isActive = btn.getAttribute('onclick') === `switchTab('${tab}')`;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
      });
      document.querySelectorAll('.section').forEach(s => {
        s.classList.toggle('active', s.id === `${tab}-section`);
      });
    }

    // Initial render
    renderSection(ADULT, 'adult-section');
    renderSection(PAEDIATRIC, 'paediatric-section');

    // Register minimal service worker for PWA installability
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./mobile-sw.js').catch(() => {});
    }
  </script>

</body>
</html>
